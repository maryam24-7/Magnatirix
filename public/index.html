<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>نظام التراسل الآمن | Secure Messaging System</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="header">
    <button id="languageToggle" class="btn language-toggle">English</button>
    <h1 id="main-title">نظام التراسل المشفر</h1>
  </div>

  <div class="container">
    <div class="card">
      <h2 id="welcome-title">مرحبًا بك في نظام التراسل المشفر</h2>
      <p id="welcome-text">هذا النظام يستخدم تقنيات التشفير المتقدمة لحماية اتصالاتك.</p>
      
      <div class="nav-links">
        <a href="sender.html" class="nav-link" id="sender-link">الانتقال إلى صفحة المرسل</a>
        <a href="receiver.html" class="nav-link" id="receiver-link">الانتقال إلى صفحة المستقبل</a>
      </div>
      
      <div class="user-list">
        <h3 id="active-users-title">المستخدمون النشطون:</h3>
        <div id="active-users-list">جاري تحميل قائمة المستخدمين...</div>
      </div>
    </div>
  </div>

  <script>
    const translations = {
      ar: {
        mainTitle: "نظام التراسل المشفر",
        welcomeTitle: "مرحبًا بك في نظام التراسل المشفر",
        welcomeText: "هذا النظام يستخدم تقنيات التشفير المتقدمة لحماية اتصالاتك.",
        senderLink: "الانتقال إلى صفحة المرسل",
        receiverLink: "الانتقال إلى صفحة المستقبل",
        languageToggle: "English",
        activeUsersTitle: "المستخدمون النشطون:",
        loadingUsers: "جاري تحميل قائمة المستخدمين..."
      },
      en: {
        mainTitle: "Secure Messaging System",
        welcomeTitle: "Welcome to Secure Messaging System",
        welcomeText: "This system uses advanced encryption techniques to protect your communications.",
        senderLink: "Go to Sender Page",
        receiverLink: "Go to Receiver Page",
        languageToggle: "العربية",
        activeUsersTitle: "Active Users:",
        loadingUsers: "Loading users list..."
      }
    };

    // Load active users
    async function loadActiveUsers() {
      try {
        const response = await fetch('/users');
        const users = await response.json();
        const usersList = document.getElementById('active-users-list');
        
        if (users.length > 0) {
          usersList.innerHTML = '<ul>' + users.map(user => `<li>${user}</li>`).join('') + '</ul>';
        } else {
          usersList.textContent = document.documentElement.lang === 'ar' ? 
            'لا يوجد مستخدمون نشطون حالياً' : 'No active users currently';
        }
      } catch (error) {
        console.error('Error loading users:', error);
        document.getElementById('active-users-list').textContent = 
          document.documentElement.lang === 'ar' ? 
          'خطأ في تحميل قائمة المستخدمين' : 'Error loading users list';
      }
    }

    document.getElementById('languageToggle').addEventListener('click', function() {
      const html = document.documentElement;
      const currentLang = html.lang;
      const newLang = currentLang === 'ar' ? 'en' : 'ar';
      
      // Update HTML attributes
      html.lang = newLang;
      html.dir = newLang === 'ar' ? 'rtl' : 'ltr';
      
      // Update all translatable elements
      document.getElementById('main-title').textContent = translations[newLang].mainTitle;
      document.getElementById('welcome-title').textContent = translations[newLang].welcomeTitle;
      document.getElementById('welcome-text').textContent = translations[newLang].welcomeText;
      document.getElementById('sender-link').textContent = translations[newLang].senderLink;
      document.getElementById('receiver-link').textContent = translations[newLang].receiverLink;
      document.getElementById('languageToggle').textContent = translations[newLang].languageToggle;
      document.getElementById('active-users-title').textContent = translations[newLang].activeUsersTitle;
      
      // Reload users list with new language
      loadActiveUsers();
      
      // Save preference to localStorage
      localStorage.setItem('preferredLang', newLang);
    });

    // Check for saved language preference
    const savedLang = localStorage.getItem('preferredLang');
    if (savedLang && savedLang !== document.documentElement.lang) {
      document.getElementById('languageToggle').click();
    }

    // Load active users on page load
    loadActiveUsers();
    
    // Refresh users list every 10 seconds
    setInterval(loadActiveUsers, 10000);
  </script>
</body>
</html>
