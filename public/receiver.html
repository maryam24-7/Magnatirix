<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>استلام الرسالة</title>
    <script src="https://cdn.jsdelivr.net/npm/jsrsasign"></script>
    <script src="https://cdn.jsdelivr.net/npm/crypto-js"></script>
    <script>
        // الدالة لفك التشفير
        function decryptMessage() {
            // استلام البيانات من المدخلات
            var encryptedMessage = document.getElementById("encryptedMessage").value;
            var encryptedKey = document.getElementById("encryptedKey").value;
            var privateKeyPem = document.getElementById("privateKey").value;

            // تحويل المفتاح الخاص من PEM إلى KeyObject
            var key = KEYUTIL.getKey(privateKeyPem);

            // فك تشفير مفتاح AES باستخدام RSA
            var decryptedKey = key.decrypt(encryptedKey);

            // تحويل المفتاح AES إلى صيغة قابل للاستخدام في CryptoJS
            var aesKey = CryptoJS.enc.Utf8.parse(decryptedKey);

            // فك تشفير الرسالة باستخدام AES
            var decryptedMessage = CryptoJS.AES.decrypt(encryptedMessage, aesKey, { iv: CryptoJS.enc.Utf8.parse('1234567890123456') }).toString(CryptoJS.enc.Utf8);

            // عرض الرسالة المفكوكة
            document.getElementById("decryptedMessage").textContent = "الرسالة المفكوكة: " + decryptedMessage;
        }
    </script>
</head>
<body>
    <h1>استلام الرسالة المشفرة</h1>

    <label for="privateKey">المفتاح الخاص (PEM):</label><br>
    <textarea id="privateKey" rows="10" cols="50" placeholder="أدخل المفتاح الخاص هنا"></textarea><br><br>

    <label for="encryptedKey">المفتاح المشفر (RSA):</label><br>
    <textarea id="encryptedKey" rows="2" cols="50" placeholder="أدخل المفتاح المشفر هنا"></textarea><br><br>

    <label for="encryptedMessage">الرسالة المشفرة (AES):</label><br>
    <textarea id="encryptedMessage" rows="5" cols="50" placeholder="أدخل الرسالة المشفرة هنا"></textarea><br><br>

    <button onclick="decryptMessage()">فك التشفير</button><br><br>

    <div id="decryptedMessage"></div>
</body>
</html>
